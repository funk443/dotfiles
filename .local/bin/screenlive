#!/bin/bash

set -e

usage="Usage: $0 <stream-url>"
if [[ "$#" = "0" ]]; then
    echo $usage
    exit 1
fi

refresh_rate=60
gop_size="$(($refresh_rate * 2))"

wl-screenrec --audio --audio-device wl-screenrec-input.monitor \
    --low-power off --gop-size "$gop_size" \
    --ffmpeg-encoder-options rc_mode=2 \
    --ffmpeg-muxer flv --bitrate "1 MB" --codec av1 \
    --filename "$1"
