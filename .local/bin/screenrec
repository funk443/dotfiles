#!/bin/bash

set -e

recording_path="${HOME}/Videos/Recordings"
mkdir -p "${recording_path}"

the_time="$(date +%Y%m%d-%H%M)"
the_format="mkv"
filename="${the_time}.${the_format}"

refresh_rate=60
gop_size="$(($refresh_rate * 2))"

i=1
while [[ -f "${recording_path}/${filename}" ]]; do
    filename="${the_time}-${i}.${the_format}"
    ((i++))
done

wl-screenrec --audio --audio-device wl-screenrec-input.monitor \
    --low-power off --gop-size "$gop_size" \
    --codec av1 \
    --filename "${recording_path}/${filename}"
